<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mon site</title>
    <meta
      name="description"
      content="Nous sommes une équipe dévouée de professionnels passionnés par la création
    de contenu informatif et utile en ligne."
    />
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
  <script>
    const form = document.querySelector("form");
    form.addEventListener("submit", (event) => {
      event.preventDefault();
      removeErrors();
      const formData = new FormData(form);
      fetch("./contact.php", {
        method: "POST",
        body: formData,
      })
        .then((response) => {
          console.log(response);
          // if status code is 422
          if (response.status === 422) {
            response.json().then((errors) => {
              console.log(errors);
              displayErrors(errors.erreurs);
            });
          } else if (response.status === 200) {
            // display success message
            console.log("success");
          }
        })
        .catch((error) => {
          console.error(error);
        });
    });

    function displayErrors(errors) {
      for (const key in errors) {
        const errorSpan = document.querySelector(`#error-${key}`);
        errorSpan.textContent = errors[key];
      }
    }

    function removeErrors() {
      const errorSpans = document.querySelectorAll(".error-message");
      errorSpans.forEach((errorSpan) => {
        errorSpan.textContent = "";
      });
    }
  </script>
</html>
